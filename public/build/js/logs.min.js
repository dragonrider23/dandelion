"use strict";function showDialog(e){var t=$("#dialog");t.html("<p>"+e+"</p>"),t.dialog({modal:!0,width:400,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{Ok:function(){$(this).dialog("close")}}})}var filt=!1,refreshc;$(document).ready(function(){var e=$("#datesearch");e.datepicker(),e.change(function(){$("#datesearch").datepicker("option","dateFormat","yy-mm-dd")}),$("#add_edit").css("display","none")}),$(document).on("focusin",function(e){$(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),tinymce.init({browser_spellcheck:!0});var refreshFun={runFirst:function(){refreshFun.refreshLog(),CategoryManage.grabFirstLevel(),this.startrefresh()},startrefresh:function(){refreshc=setInterval(function(){refreshFun.refreshLog()},6e4)},stoprefresh:function(){clearInterval(refreshc)},refreshLog:function(e){e&&(filt=!1,$("#searchterm").val("Keyword"),$("#datesearch").val("Date"),refreshFun.startrefresh()),filt||$.ajax({type:"POST",url:"api/i/logs/read",async:!1,dataType:"json"}).done(function(e){""===e&&window.location.reload(!0),view.makeLogView(e.data)}).fail(function(e){"undefined"!=typeof e&&4===e.readyState&&404===e.status&&$("#refreshed").html("An error has occured. Please try logging out and back in.")})}},view={makeLogView:function(e){var t=$("#refreshed");t.empty(),filt&&t.append(view.showFilterMessage()),t.append(view.pageControls(e.metadata)),t.append(view.displayLogs(e)),t.append(view.pageControls(e.metadata))},showFilterMessage:function(){var e=$("<form/>"),t='<h3>You are viewing filtered results                    <button type="button" onClick="refreshFun.refreshLog(true)">Clear Results</button></h3>';return e.append(t),e},pageControls:function(e){if(filt)return!1;var t=$("<div/>").attr("class","pagination"),a='<form method="post">';if(e.offset>0){var o=e.offset-e.limit;a+='<input type="button" value="Previous '+e.limit+'" onClick="view.pagentation('+o+');" class="flle">'}if(e.offset+e.limit<e.logSize){var r=e.offset+e.limit;a+='<input type="button" value="Next '+e.limit+'" onClick="view.pagentation('+r+');" class="flri">'}return a+="</form></div>",t.append(a),t},displayLogs:function(e){var t=$("<div/>").attr("id","refreshed_core");for(var a in e)if(e.hasOwnProperty(a)&&"metadata"!=a){var o=e[a],r=o.realname;""===r&&(r="Unknown User");var n='<form method="post">                        <div class="logentry">                        <h2>'+o.title+'</h2>                        <p class="entry">'+o.entry+'</p>                        <p class="entrymeta">Created by '+r+" on "+o.datec+" @ "+o.timec+" ";"1"==o.edited&&(n+="(Edited)"),n+="<br>Categorized as "+o.cat+'<br><a href="#" onClick="searchFun.filter(\''+o.cat+"');\">Learn more about this system...</a>",o.canEdit&&(n+='<input type="button" value="Edit" onClick="editFun.grabedit('+o.logid+');" class="flri">'),n+="</p></div></form>",t.append(n)}return t},pagentation:function(e){$.post("api/i/logs/read",{offset:e},null,"json").done(function(t){view.makeLogView(t.data),0>=e?(refreshFun.refreshLog(),refreshFun.startrefresh()):refreshFun.stoprefresh(),window.scrollTo(0,0)}).fail(function(e){"undefined"!=typeof e&&4===e.readyState&&404===e.status&&$("#refreshed").html("An error has occured. Please try logging out and back in.")})}},addFun={showaddinputs:function(){var e=$("textarea#logEntry");$("#add_edit_form")[0].reset(),e.html(""),$("#add_edit").dialog({height:575,width:800,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add Log":function(){addFun.sendLog(!0)},Cancel:function(){$(this).dialog("close"),CategoryManage.addEditLog=!1,CategoryManage.grabFirstLevel()}}}),e.tinymce({browser_spellcheck:!0,forced_root_block:!1,resize:!1,menubar:"edit format view insert tools",toolbar:"undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | forecolor",plugins:["autolink link lists hr anchor pagebreak","searchreplace wordcount code insertdatetime","template paste textcolor"]}),CategoryManage.addEditLog=!0,CategoryManage.grabFirstLevel()},sendLog:function(e,t){var a={},o="",r=$("input#logTitle").val();r=encodeURIComponent(r);var n=$("textarea#logEntry").val();n=encodeURIComponent(n);var i=CategoryManage.getCatString();e?(a={title:r,body:n,cat:i},o="api/i/logs/create"):(a={logid:t,title:r,body:n,cat:i},o="api/i/logs/edit"),""!==r&&""!==n&&""!==i&&i!==!1?($("#add_edit").dialog("close"),$("#messages").fadeOut(),$.post(o,a,null,"json").done(function(e){refreshFun.refreshLog(),CategoryManage.addEditLog=!1,CategoryManage.grabFirstLevel(),showDialog(e.data)})):($("#messages").html('<span class="bad">Log entries must have a title, category, and entry text.</span>').fadeIn(),CategoryManage.addEditLog=!0,CategoryManage.grabFirstLevel(),setTimeout(function(){$("#messages").fadeOut()},1e4))}},editFun={showeditinputs:function(e){var t=e.data,a=$("textarea#logEntry");$("input#logTitle").val(t.title),a.val(t.entry),$("#catSpace").text("Loading categories..."),CategoryManage.renderCategoriesFromString(t.cat,function(e){CategoryManage.addEditLog=!0,$("#categorySelects").empty(),$("#catSpace").html(e)}),$("#add_edit").dialog({height:575,width:800,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Save Edit":function(){addFun.sendLog(!1,t.logid)},Cancel:function(){$(this).dialog("close"),CategoryManage.addEditLog=!1,CategoryManage.grabFirstLevel()}}}),a.tinymce({browser_spellcheck:!0,forced_root_block:!1,resize:!1,menubar:"edit format view insert tools",toolbar:"undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | forecolor",plugins:["autolink link lists hr anchor pagebreak","searchreplace wordcount code insertdatetime","template paste textcolor"]})},grabedit:function(e){$.post("api/i/logs/readone",{logid:e},null,"json").done(editFun.showeditinputs)}},searchFun={check:function(e){13==e.keyCode&&searchFun.searchlog()},searchlog:function(){var e=$("input#searchterm").val(),t=$("input#datesearch").val();"Keyword"===e&&(e=""),"Date"===t&&(t=""),e=encodeURIComponent(e),$.post("api/i/logs/search",{kw:e,date:t}).done(function(e){filt=!0,refreshFun.stoprefresh(),view.makeLogView(e.data)})},filter:function(e){""===e&&(e=CategoryManage.getCatString()),e?$.post("api/i/logs/filter",{filter:e},null,"json").done(function(e){filt=!0,refreshFun.stoprefresh(),view.makeLogView(e.data)}).fail(function(e){"undefined"!=typeof e&&4===e.readyState&&404===e.status&&$("#refreshed").html("An error has occured. Please try logging out and back in.")}):alert("Please select a valid filter.")}};
//# sourceMappingURL=maps/logs.min.js.map