"use strict";function showDialog(e){$("#dialog").html("<p>"+e+"</p>"),$("#dialog").dialog({modal:!0,width:400,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{Ok:function(){$(this).dialog("close")}}})}var filt=!1,refreshc;$(document).ready(function(){$("#datesearch").datepicker(),$("#datesearch").change(function(){$("#datesearch").datepicker("option","dateFormat","yy-mm-dd")}),$("#add_edit").css("display","none")}),$(document).on("focusin",function(e){$(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),tinymce.init({browser_spellcheck:!0});var refreshFun={runFirst:function(){refreshFun.refreshLog(),CategoryManage.grabNextLevel("0:0"),this.startrefresh()},startrefresh:function(){refreshc=setInterval(function(){refreshFun.refreshLog()},6e4)},stoprefresh:function(){clearInterval(refreshc)},refreshLog:function(e){e&&(filt=!1,$("#searchterm").val("Keyword"),$("#datesearch").val("Date"),refreshFun.startrefresh()),filt||$.ajax({type:"POST",url:"api/i/logs/read",async:!1,dataType:"json"}).done(function(e){""===e&&window.location.reload(!0),view.makeLogView(e.data)}).fail(function(e){"undefined"!=typeof e&&4===e.readyState&&404===e.status&&$("#refreshed").html("An error has occured. Please try logging out and back in.")})}},view={makeLogView:function(e){$("#refreshed").empty(),filt&&$("#refreshed").append(view.showFilterMessage()),$("#refreshed").append(view.pageControls(e.metadata)),$("#refreshed").append(view.displayLogs(e)),$("#refreshed").append(view.pageControls(e.metadata))},showFilterMessage:function(){var e=$("<form/>"),t='<h3>You are viewing filtered results                    <button type="button" onClick="refreshFun.refreshLog(true)">Clear Results</button></h3>';return e.append(t),e},pageControls:function(e){if(filt)return!1;var t=$("<div/>").attr("class","pagination"),a='<form method="post">';if(e.offset>0){var o=e.offset-e.limit;a+='<input type="button" value="Previous '+e.limit+'" onClick="view.pagentation('+o+');" class="flle">'}if(e.offset+e.limit<e.logSize){var n=e.offset+e.limit;a+='<input type="button" value="Next '+e.limit+'" onClick="view.pagentation('+n+');" class="flri">'}return a+="</form></div>",t.append(a),t},displayLogs:function(e){var t=$("<div/>").attr("id","refreshed_core");for(var a in e)if(e.hasOwnProperty(a)&&"metadata"!=a){var o=e[a],n=o.realname;""===n&&(n="Unknown User");var r='<form method="post">                        <div class="logentry">                        <h2>'+o.title+'</h2>                        <p class="entry">'+o.entry+'</p>                        <p class="entrymeta">Created by '+n+" on "+o.datec+" @ "+o.timec+" ";"1"==o.edited&&(r+="(Edited)"),r+="<br>Categorized as "+o.cat+'                     <br><a href="#" onClick="searchFun.filter(\''+o.cat+"');\">Learn more about this system...</a>",o.canEdit&&(r+='<input type="button" value="Edit" onClick="editFun.grabedit('+o.logid+');" class="flri">'),r+="</p></div></form>",t.append(r)}return t},pagentation:function(e){$.post("api/i/logs/read",{offset:e},null,"json").done(function(t){view.makeLogView(t.data),0>=e?(refreshFun.refreshLog(),refreshFun.startrefresh()):refreshFun.stoprefresh(),window.scrollTo(0,0)}).fail(function(e){"undefined"!=typeof e&&4===e.readyState&&404===e.status&&$("#refreshed").html("An error has occured. Please try logging out and back in.")})}},addFun={showaddinputs:function(){$("#add_edit_form")[0].reset(),$("textarea#logEntry").html(""),$("#add_edit").dialog({height:575,width:800,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Add Log":function(){addFun.addlog()},Cancel:function(){$(this).dialog("close"),CategoryManage.addLog=!1,CategoryManage.grabNextLevel("0:0")}}}),$("textarea#logEntry").tinymce({browser_spellcheck:!0,forced_root_block:!1,resize:!1,menubar:"edit format view insert tools",toolbar:"undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | forecolor",plugins:["autolink link lists hr anchor pagebreak","searchreplace wordcount code insertdatetime","template paste textcolor"]}),CategoryManage.addLog=!0,CategoryManage.grabNextLevel("0:0")},addlog:function(){var e=$("input#logTitle").val();e=encodeURIComponent(e);var t=$("textarea#logEntry").val();t=encodeURIComponent(t);var a=CategoryManage.getCatString();""!==e&&""!==t&&""!==a?($("#add_edit").dialog("close"),$("#messages").fadeOut(),$.post("api/i/logs/create",{title:e,body:t,cat:a},null,"json").done(function(e){refreshFun.refreshLog(),CategoryManage.addLog=!1,CategoryManage.grabNextLevel("0:0"),showDialog(e.data)})):($("input#logTitle").val(decodeURIComponent(e)),$("textarea#logEntry").html(decodeURIComponent(t)),$("#messages").html('<span class="bad">Log entries must have a title, category, and entry text.</span>').fadeIn(),CategoryManage.addLog=!0,CategoryManage.grabNextLevel("0:0"),setTimeout(function(){$("#messages").fadeOut()},1e4))}},editFun={showeditinputs:function(e){var t=e.data;$("input#logTitle").val(t.title),$("textarea#logEntry").val(t.entry),$("#catSpace").text(t.cat),$("#add_edit").dialog({height:575,width:800,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Save Edit":function(){editFun.editlogs(t.logid)},Cancel:function(){$(this).dialog("close")}}}),$("textarea#logEntry").tinymce({browser_spellcheck:!0,forced_root_block:!1,resize:!1,menubar:"edit format view insert tools",toolbar:"undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | forecolor",plugins:["autolink link lists hr anchor pagebreak","searchreplace wordcount code insertdatetime","template paste textcolor"]})},grabedit:function(e){$.post("api/i/logs/readone",{logid:e},null,"json").done(editFun.showeditinputs)},editlogs:function(e){var t=$("input#logTitle").val();t=encodeURIComponent(t);var a=$("textarea#logEntry").val();a=encodeURIComponent(a),""!==t&&""!==a?($("#add_edit").dialog("close"),$("#messages").fadeOut(),$.post("api/i/logs/edit",{logid:e,title:t,body:a},null,"json").done(function(e){refreshFun.refreshLog(),showDialog(e.data)})):($("#messages").html('<span class="bad">Log entries must have a title, category, and entry text.</span>').fadeIn(),setTimeout(function(){$("#messages").fadeOut()},1e4))}},searchFun={check:function(e){13==e.keyCode&&searchFun.searchlog()},searchlog:function(){var e=$("input#searchterm").val(),t=$("input#datesearch").val();"Keyword"===e&&(e=""),"Date"===t&&(t=""),e=encodeURIComponent(e),$.post("api/i/logs/search",{kw:e,date:t}).done(function(e){filt=!0,refreshFun.stoprefresh(),view.makeLogView(e.data)})},filter:function(e){""===e&&(e=CategoryManage.getCatString()),e?$.post("api/i/logs/filter",{filter:e},null,"json").done(function(e){filt=!0,refreshFun.stoprefresh(),view.makeLogView(e.data)}).fail(function(e){"undefined"!=typeof e&&4===e.readyState&&404===e.status&&$("#refreshed").html("An error has occured. Please try logging out and back in.")}):alert("Please select a valid filter.")}};
//# sourceMappingURL=maps/logs.min.js.map