"use strict";var newStatus=1,presence={timeoutId:0,version:0,firstgen:!0,checkstat:function(t){$.getJSON("api/i/cheesto/readall",function(e){5!=e.errorcode&&(presence.generateView(t,e),clearTimeout(presence.timeoutId),delete presence.timeoutId,presence.version=t,presence.timeoutId=setTimeout(function(){presence.checkstat(t)},3e4))})},generateView:function(t,e){if(e=e.data,!this.firstgen)return void this.updateTableOnly(t,e);var s=$("<div/>").attr("id","pt");s.append(presence.makeStatusSelect(t,e));var a,n=$("<div/>").attr("id","userStatuses");0===t?a=this.makeTableMini(e):1===t&&(a=this.makeTableFull(e)),n.append(a),s.append(n),$("#mainPresence").html(s)},updateTableOnly:function(t,e){var s;0===t?s=this.makeTableMini(e):1===t&&(s=this.makeTableFull(e)),$("#userStatuses").html(s)},makeStatusSelect:function(t,e){var s=$("<div/>").attr("id","statusSelect"),a=$("<select/>").attr("id","cstatus");a.change(function(){presence.setStatus(t)}),a.append('<option value="-1">Set Status:</option>');for(var n in e.statusOptions){var i="<option>"+e.statusOptions[n]+"</option>";a.append(i)}return s.append(a),this.firstgen=!1,s},makeTableMini:function(t){var e=$("<table/>"),s='<thead><tr>            <td width="50%">Name</td>            <td width="50%">Status</td>            </tr></thead>';e.append(s);for(var a in t)if(t.hasOwnProperty(a)&&"statusOptions"!==a){var n=t[a],i="";""!==n.message&&(i=' class="message"');var r='<tr>                    <td class="textLeft"><span title="'+n.message+'"'+i+">"+n.realname+'</span></td>                    <td><span title="'+t.statusOptions[n.status]+"&#013;Return: "+n.returntime+'" class="'+n.statusInfo.color+'">'+n.statusInfo.symbol+"</td>                    </tr>";e.append(r)}var o='<tr><td colspan="3" width="100%" class="cen">            <form><input type="button" onClick="presence.popOut();" class="linklike" value="Popout &#264;eesto"></form>            </td></tr>';return e.append(o),e},makeTableFull:function(t){var e=$("<table/>"),s='<thead><tr><td>Name</td>            <td>Message</td>            <td colspan="2">Status</td>            <td>Last Changed</td>            </tr></thead><tbody>';e.append(s);for(var a in t)if(t.hasOwnProperty(a)&&"statusOptions"!==a){var n=t[a],i="<tr>                    <td>"+n.realname+"</td>                    <td>"+n.message+'</td>                    <td class="statusi"><span class="'+n.statusInfo.color+'">'+n.statusInfo.symbol+"</span></td>";i+=0==n.status?"<td>"+t.statusOptions[n.status]+"</td>":"<td>"+t.statusOptions[n.status]+"<br>Return: "+n.returntime+"</td>",i+="<td>"+n.dmodified+"</td></tr>",e.append(i)}return e},setStatus:function(t){newStatus=$("select#cstatus").prop("selectedIndex")-1,$("select#cstatus").prop("selectedIndex",0);var e;newStatus>0?(e="",window.open("getdate","getdate","location=no,menubar=no,scrollbars=no,status=no,height=550,width=350")):0===newStatus&&(e="00:00:00",presence.sendNewStatus(0,e,t,""))},popOut:function(){window.open("presenceWindow","presencewin","location=no,menubar=no,scrollbars=no,status=no,height=500,width=950")},sendNewStatus:function(t,e,s,a){$.post("api/i/cheesto/update",{status:t,returntime:e,message:a},function(){presence.checkstat(s)})},showHideP:function(){"[ - ]"==$("#showHide").html()?($("#presence").css("minWidth",$("#mainPresence").prop("offsetWidth")+"px"),$("#mainPresence").css("display","none"),$("#showHide").html("[ + ]")):($("#presence").css("minWidth","0px"),$("#mainPresence").css("display",""),$("#showHide").html("[ - ]"))}};
//# sourceMappingURL=maps/cheesto.min.js.map