{"version":3,"sources":["mail.js"],"names":["$","document","ready","css","mail","showFolder","on","e","target","closest","length","stopImmediatePropagation","areUnread","getJSON","data","count","attr","setTimeout","folderName","val","this","getAllMail","getTrashCan","showMailList","trash","parsed","mailItems","html","table","addClass","append","i","mailItem","id","realname","subject","dateSent","isItRead","viewMail","mid","timeSent","body","dialog","modal","width","show","effect","duration","hide","buttons","Ok","replyToMail","selection","getSelectedMailIds","reset","fromUser","prop","showWriteDialog","writeMailDialog","users","each","key","value","user","label","userid","push","autocomplete","minLength","source","focus","event","ui","item","select","_renderItem","ul","appendTo","height","Send Mail","sendMail","Cancel","tinymce","browser_spellcheck","forced_root_block","resize","menubar","toolbar","plugins","mailPiece","to","JSON","stringify","post","parse","alert","deleteMail","selected","confirm","permenant","selectedMail"],"mappings":"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","file":"mail.min.js","sourcesContent":["/* global $, document, setTimeout, alert, confirm */\n/* jshint multistr: true */\n\n\"use strict\"; // jshint ignore:line\n\n$(document).ready(function() {\n    $(\"#writeMail\").css(\"display\", \"none\");\n    mail.showFolder();\n});\n\n$(document).on(\"focusin\", function(e) {\n    if ($(e.target).closest(\".mce-window\").length) {\n        e.stopImmediatePropagation();\n    }\n});\n\nvar mail = {\n        areUnread: function() {\n            $.getJSON(\"api/i/mail/mailCount\", function(data) {\n                if (data.data.count > 0) {\n                    $(\"#mailicon\").attr(\"src\", \"static/images/mail.png\");\n                    $(\"#mailicon\").attr(\"alt\", \"You have mail\");\n                    $(\"#mailicon\").attr(\"title\", data.data.count);\n                }\n            });\n\n            setTimeout(function(){ mail.areUnread(); }, 10000);\n        },\n        \n        showFolder: function() {\n            var folderName = $(\"#folder\").val();\n            switch (folderName) {\n                case \"inbox\":\n                    this.getAllMail();\n                    break;\n                    \n                case \"trash\":\n                    this.getTrashCan();\n                    break;\n            }\n        },\n\n        getAllMail: function() {\n            $.getJSON(\"api/i/mail/getAllMail\",\n                    function(data){ mail.showMailList(data.data); });\n        },\n        \n        getTrashCan: function() {\n            $.getJSON(\"api/i/mail/getAllMail\", {\"trash\": \"true\"},\n                    function(data){ mail.showMailList(data.data); });\n        },\n\n        showMailList: function(parsed) {\n            var mailItems = parsed.length;\n\n            $('#mailList').html('');\n            var table = $('<table/>').addClass(\"mailboxCSS\");\n\n            table.append('<tr>\\\n                    <th width=\"2%\">&nbsp;</th>\\\n                    <th width=\"15%\">From</th>\\\n                    <th width=\"63%\">Subject</th>\\\n                    <th width=\"20%\">Date</th>\\\n            </tr>');\n\n            for(var i=0; i<mailItems; i++){\n                var mailItem = parsed[i];\n\n                var html = '<tr>\\\n                    <td><input type=\"checkbox\" id=\"check'+i+'\" value='+mailItem.id+'></td>\\\n                    <td>'+mailItem.realname+'</td>\\\n                    <td><a href=\"#\" onClick=\"mail.viewMail('+mailItem.id+');\">'+mailItem.subject+'</a></td>\\\n                    <td>'+mailItem.dateSent+'</td>\\\n                    </tr>';\n\n                if (mailItem.isItRead == \"0\") {\n                    table.append($(html).addClass('unread'));\n                }\n                else {\n                    table.append(html);\n                }\n            }\n\n            $('#mailList').append(table);\n        },\n\n        viewMail: function(id) {\n            $.getJSON(\"api/i/mail/read\", {mid: id}, function(data) {\n                data = data.data;\n                mail.showFolder();\n\n                var html = '<h2>'+data[0].subject+'</h2>\\\n                To: You<br>\\\n                From: '+data[0].realname+'<br>\\\n                Sent: '+data[0].dateSent+' '+data[0].timeSent+'<br>\\\n                <br>'+data[0].body;\n\n                $( \"#mailDialog\" ).html( html );\n                $( \"#mailDialog\" ).dialog({\n                    modal: true,\n                    width: 400,\n                    show: {\n                        effect: \"fade\",\n                        duration: 500\n                    },\n                    hide: {\n                        effect: \"fade\",\n                        duration: 500\n                    },\n                    buttons: {\n                        Ok: function() {\n                            $( this ).dialog( \"close\" );\n                            $( \"#mailDialog\" ).html( '' );\n                        }\n                    }\n                });\n            });\n        },\n\n        replyToMail: function() {\n            var selection = this.getSelectedMailIds();\n            if (selection.length == 1) {\n                $.getJSON(\"api/i/mail/read\", {mid: selection[0]}, function(data) {\n                    data = data.data;\n                    $(\"#mailForm\")[0].reset();\n                    $(\"textarea#mailBody\").html(data[0].body);\n                    $(\"#mailSubject\").val(\"RE: \" + data[0].subject);\n                    $(\"#toUsersId\").val(data[0].fromUser);\n                    $(\"#toUsers\").val(data[0].realname);\n                    $(\"#toUsers\").prop(\"readonly\", true);\n                    \n                    mail.showWriteDialog();\n                });\n            }\n        },\n\n        writeMailDialog: function() {\n            $.getJSON(\"api/i/mail/getUserList\", function(data) {\n                data = data.data;\n                $(\"#mailForm\")[0].reset();\n                $(\"#toUsers\").prop(\"readonly\", false);\n                $(\"textarea#mailBody\").html(\"\");\n                $(\"#toUsersId\").val(\"\");\n\n                mail.showWriteDialog();\n\n                var users = [];\n\n                $(data).each(function(key, value) {\n                    var user = [];\n                    user.label = value.realname;\n                    user.value = value.userid;\n                    users.push(user);\n                });\n\n                $(\"#toUsers\").autocomplete({\n                    minLength: 0,\n                    source: users,\n                    focus: function( event, ui ) {\n                        $( \"#toUsers\" ).val( ui.item.label );\n                        return false;\n                    },\n                    select: function( event, ui ) {\n                        $( \"#toUsers\" ).val( ui.item.label );\n                        $( \"#toUsersId\" ).val( ui.item.value );\n                        return false;\n                    }\n                })\n                .data( \"ui-autocomplete\" )._renderItem = function( ul, item ) {\n                    return $( \"<li>\" )\n                    .append( \"<a>\" + item.label + \"</a>\" )\n                    .appendTo( ul );\n                };\n            });\n        },\n        \n        showWriteDialog: function() {\n            $( \"#writeMail\" ).dialog({\n                height: 575,\n                width: 800,\n                modal: true,\n                show: {\n                    effect: \"fade\",\n                    duration: 500\n                },\n                hide: {\n                    effect: \"fade\",\n                    duration: 500\n                },\n                buttons: {\n                    \"Send Mail\": function() {\n                        if (mail.sendMail()) {\n                            $( this ).dialog( \"close\" );\n                            mail.showFolder();\n                        }\n                    },\n                    Cancel: function() {\n                        $( this ).dialog( \"close\" );\n                    }\n                }\n            });\n\n            $(\"textarea#mailBody\").tinymce({\n                browser_spellcheck: true,\n                forced_root_block: false,\n                resize: false,\n                menubar: \"edit format view insert tools\",\n                toolbar: \"undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | forecolor\",\n                plugins: [\n                          \"autolink link lists hr anchor pagebreak\",\n                          \"searchreplace wordcount code insertdatetime\",\n                          \"template paste textcolor\"\n                          ]\n            });\n        },\n\n        sendMail: function() {\n            var mailPiece = {};\n\n            mailPiece.to = $(\"#toUsersId\").val();\n            mailPiece.subject = $(\"#mailSubject\").val();\n            mailPiece.body = $(\"#mailBody\").val();\n\n            if (mailPiece.to !== \"\" && mailPiece.subject !== \"\" && mailPiece.body !== \"\") {\n                mailPiece = JSON.stringify(mailPiece);\n\n                $.post(\"api/i/mail/send\", {mail: mailPiece},\n                        function(data) {\n                    data = JSON.parse(data);\n                    alert(data.data);\n                });\n\n                return true;\n            }\n            else {\n                alert(\"Error: You need a subject, body, and recipient.\");\n                return false;\n            }\n        },\n        \n        deleteMail: function() {\n            var selected = this.getSelectedMailIds();\n\n            if (selected.length === 1 && confirm(\"Delete Selected Mail?\")) {\n                var permenant = false;\n                \n                if ($(\"#folder\").val() == \"trash\") {\n                    permenant = true;\n                }\n                \n                $.post(\"api/i/mail/delete\", {\"mid\": selected[0], \"permenant\": permenant},\n                    function(data) {\n                        data = JSON.parse(data);\n                        mail.showFolder();\n                        alert(data.data);\n                });\n            }\n        },\n\n        getSelectedMailIds: function() {\n            var selectedMail = [];\n\n            $(\"#mailList :checked\").each(function() {\n                selectedMail.push($(this).val());\n            });\n\n            return selectedMail;\n        }\n};"],"sourceRoot":"/source/"}