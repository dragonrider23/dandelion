{"version":3,"sources":["catManage.js"],"names":["CategoryManage","currentID","currentSelection","addEditLog","grabNextLevel","pid","container","this","pidSplit","split","level","cid","splice","$","get","pastSelection","JSON","stringify","done","json","empty","html","renderSelectsFromJson","grabFirstLevel","currentList","div","onChangeFunc","value","key","levels","hasOwnProperty","select","attr","change","append","category","cat","option","id","desc","selected","renderCategoriesFromString","str","callback","catstring","rendered","createNew","catString","getCatString","message","length","newCatDesc","window","prompt","addNew","encodeURIComponent","alert","catDesc","parent","post","parentID","data","editCat","lvl","elt","val","editString","text","editedCat","deleteCat","myCatString","confirm","i","substring"],"mappings":"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","file":"catManage.min.js","sourcesContent":["/* global $, window, alert */\n\n\"use strict\"; // jshint ignore:line\n\nvar CategoryManage = {\n\tcurrentID: -1,\n\tcurrentSelection: [0],\n\taddEditLog: false,\n\n\tgrabNextLevel: function(pid, container) {\n\t\tcontainer = (this.addEditLog) ? '#catSpace' : '#categorySelects';\n\n\t\tvar pidSplit = pid.split(':');\n\t\tvar level = +pidSplit[0] + 1;\n\t\tvar cid = +pidSplit[1];\n\n\t\tif (this.currentSelection[level]) {\n\t\t\t// This is to ensure that if a category is changed in the upper levels,\n\t\t\t// no residual children will remain\n\t\t\tthis.currentSelection.splice(level);\n\t\t}\n\n\t\tthis.currentSelection[level] = cid;\n\n\t\t$.get('render/categoriesJson', {pastSelection: JSON.stringify(this.currentSelection)}, null, 'json')\n\t\t\t.done(function(json) {\n\t\t\t\tif (typeof $(container)[0] !== 'undefined') {\n\t\t\t\t\t$(container).empty();\n\t\t\t\t\t$(container).html(CategoryManage.renderSelectsFromJson(json));\n\t\t\t\t\tCategoryManage.currentID = pid;\n\t\t\t\t}\n\t\t\t});\n\t},\n\n\tgrabFirstLevel: function() {\n\t\tthis.grabNextLevel('-1:0');\n\t},\n\n\trenderSelectsFromJson: function(json) {\n\t\tCategoryManage.currentSelection = json.currentList;\n\t\tvar div = $('<span/>');\n\n\t\tvar onChangeFunc = function() {\n\t\t\tCategoryManage.grabNextLevel(this.value);\n\t\t};\n\n\t\tfor (var key in json.levels) {\n\t\t\tif (!json.levels.hasOwnProperty(key))\n\t\t\t\tcontinue;\n\n\t\t\tvar select = $('<select/>').attr('id', 'level'+key);\n\t\t\tselect.change(onChangeFunc);\n\t\t\tselect.append('<option value=\"\">Select:</option>');\n\n\t\t\tfor (var category in json.levels[key]) {\n\t\t\t\tif (!json.levels[key].hasOwnProperty(category))\n\t\t\t\t\tcontinue;\n\n\t\t\t\tvar cat = json.levels[key][category];\n\t\t\t\tvar option = $('<option value=\"'+key+':'+cat.id+'\">'+cat.desc+'</option>');\n\t\t\t\toption.attr('selected', cat.selected);\n\t\t\t\tselect.append(option);\n\t\t\t}\n\t\t\tdiv.append(select);\n\t\t}\n\n\t\treturn div;\n\t},\n\n\trenderCategoriesFromString: function(str, callback) {\n\t\t$.get('render/editcat', {catstring: str}, null, 'json')\n\t\t\t.done(function(json) {\n\t\t\t\tvar rendered = CategoryManage.renderSelectsFromJson(json);\n\t\t\t\tcallback(rendered);\n\t\t\t});\n\t},\n\n\tcreateNew: function() {\n\t\tvar catString = this.getCatString();\n\t\tvar message = 'Add new category\\n\\n';\n\n\t\tif (this.currentSelection.length == 1) {\n\t\t\tmessage = 'Create new root category:';\n\t\t\tcatString = '';\n\t\t}\n\n\t\twhile (true) {\n\t\t\tvar newCatDesc = window.prompt(message+catString);\n\n\t\t\tif (newCatDesc === '') {\n\t\t\t\talert('Please enter a category description');\n\t\t\t} else if (newCatDesc === null) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tthis.addNew(encodeURIComponent(newCatDesc));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\taddNew: function(catDesc) {\n\t\tvar newCatDesc = catDesc;\n\t\tvar parent = this.currentSelection[this.currentSelection.length-1];\n\n\t\t$.post(\"api/i/categories/add\", { parentID: parent, catDesc: newCatDesc }, null, 'json')\n            .done(function( json ) {\n                alert(json.data);\n\t\t\t\tCategoryManage.grabNextLevel(CategoryManage.currentSelection[CategoryManage.currentSelection.length-2]);\n            });\n\t},\n\n\teditCat: function() {\n\t\tvar cid = this.currentSelection[this.currentSelection.length-1];\n\t\tvar lvl = this.currentSelection.length-2;\n\n\t\tvar elt = $(\"#level\"+lvl+\" option:selected\");\n\n\t\tif (typeof elt.val() !== 'undefined') {\n\t\t\tvar editString = elt.text();\n            var editedCat = window.prompt(\"Edit Category Description:\",editString);\n\n            if (editedCat !== null && editedCat !== '') {\n                $.post(\"api/i/categories/edit\", { cid: cid, catDesc: encodeURIComponent(editedCat) }, null, 'json')\n                    .done(function( json ) {\n                        alert(json.data);\n                        CategoryManage.grabNextLevel(CategoryManage.currentSelection[CategoryManage.currentSelection.length-2]);\n                    });\n            }\n\t\t}\n\t},\n\n\tdeleteCat: function() {\n\t\tvar myCatString = this.getCatString();\n\t\tvar cid = this.currentSelection[this.currentSelection.length-1];\n\n\t\tif (!window.confirm('Delete '+ myCatString +'?\\n\\nWarning: All child categories will be moved up one level!')) {\n\t\t\treturn false;\n\t\t}\n\n        $.post(\"api/i/categories/delete\", { cid: cid }, null ,'json')\n            .done(function( json ) {\n                alert(json.data);\n                CategoryManage.grabNextLevel(CategoryManage.currentSelection[CategoryManage.currentSelection.length-2]);\n            });\n\t},\n\n\tgetCatString: function() {\n\t\tvar catString = '';\n\n\t\tfor (var i=0; i<this.currentSelection.length; i++) {\n\t\t\tif ($(\"#level\"+(i))) {\n\t\t\t\tvar elt = $(\"#level\"+(i)+\" option:selected\");\n\n\t\t\t\tif (elt.text() != 'Select:') {\n\t\t\t\t\tcatString += elt.text() + ':';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (catString.length > 0) {\n\t\t\treturn catString.substring(0, catString.length - 1);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n};\n"],"sourceRoot":"/source/"}