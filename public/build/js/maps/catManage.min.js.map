{"version":3,"sources":["catManage.js"],"names":["CategoryManage","currentID","currentSelection","addLog","grabNextLevel","parentID","container","pid","value","this","level","split","splice","length","$","ajax","type","url","data","action","pastSelections","JSON","stringify","async","done","html","i","val","createNew","catString","getCatString","message","newCatDesc","window","prompt","addNew","encodeURIComponent","alert","catDesc","parent","post","json","editCat","cid","elt","editString","text","editedCat","deleteCat","myCatString","confirm","substring"],"mappings":"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","file":"catManage.min.js","sourcesContent":["/* global $, window, alert */\n\n\"use strict\"; // jshint ignore:line\n\nvar CategoryManage = {\n\tcurrentID: -1,\n\tcurrentSelection: [],\n\taddLog: false,\n\n\tgrabNextLevel: function(parentID, container) {\n\t    var pid;\n\t\tif (parentID.value) {\n\t\t\tpid = parentID.value;\n\t\t} else {\n\t\t\tpid = parentID;\n\t\t}\n\n\t\tcontainer = (this.addLog) ? '#catSpace' : '#categorySelects';\n\n\t\tvar level = pid.split(':');\n\n\t\tif (this.currentSelection[level[1]]) {\n\t\t\tthis.currentSelection.splice(level[1]);\n\t\t}\n\n\t\tthis.currentSelection[level[1]] = pid;\n\n        if (this.currentSelection.length === 0) {\n\t\t\tthis.currentSelection[0] = '0:0';\n\t\t}\n\n\t\t$.ajax({\n            type: \"POST\",\n            url: \"lib/categories\",\n            data: { action: \"grabcats\", pastSelections: JSON.stringify(this.currentSelection)},\n            async: false\n        })\n            .done(function( html ) {\n                if (typeof $(\"#categorySelects\")[0] !== 'undefined') {\n                    $(\"#categorySelects\").html(\"\");\n                    $(container).html( html );\n                    CategoryManage.currentID = pid;\n\n                    for (var i=1; i<CategoryManage.currentSelection.length; i++) {\n                        $(\"#level\"+i).val( CategoryManage.currentSelection[i] );\n                    }\n                }\n            });\n\t},\n\n\tcreateNew: function() {\n\t\tvar catString = this.getCatString();\n\t\tvar message = 'Add new category\\n\\n';\n\n\t\tif (this.currentSelection.length == 1) {\n\t\t\tmessage = 'Create new root category:';\n\t\t\tcatString = '';\n\t\t}\n\n\t\twhile (true) {\n\t\t\tvar newCatDesc = window.prompt(message+catString);\n\n\t\t\tif (newCatDesc === '') {\n\t\t\t\talert('Please enter a category description');\n\t\t\t}\n\t\t\telse if (newCatDesc === null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.addNew(encodeURIComponent(newCatDesc));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\taddNew: function(catDesc) {\n\t\tvar newCatDesc = catDesc;\n\t\tvar parent = this.currentSelection[this.currentSelection.length-1].split(':');\n\t\tparent = parent[0];\n\n\t\t$.post(\"api/i/categories/add\", { parentID: parent, catDesc: newCatDesc }, null, 'json')\n            .done(function( json ) {\n                alert(json.data);\n\t\t\t\tCategoryManage.grabNextLevel(CategoryManage.currentSelection[CategoryManage.currentSelection.length-2]);\n            });\n\t},\n\n\teditCat: function() {\n\t\tvar cid = this.currentSelection[this.currentSelection.length-1].split(':');\n\n\t\tvar elt = $(\"#level\"+cid[1]+\" option:selected\");\n\n\t\tif (typeof elt.val() !== 'undefined') {\n\t\t\tvar editString = elt.text();\n            var editedCat = window.prompt(\"Edit Category Description:\",editString);\n\n            if (editedCat !== null && editedCat !== '') {\n                $.post(\"api/i/categories/edit\", { cid: cid[0], catDesc: encodeURIComponent(editedCat) }, null, 'json')\n                    .done(function( json ) {\n                        alert(json.data);\n                        CategoryManage.grabNextLevel(CategoryManage.currentSelection[CategoryManage.currentSelection.length-2]);\n                    });\n            }\n\t\t}\n\t},\n\n\tdeleteCat: function() {\n\t\tvar myCatString = this.getCatString();\n\t\tvar cid = this.currentSelection[this.currentSelection.length-1].split(':');\n\t\tcid = cid[0];\n\n\t\tif (!window.confirm('Delete '+ myCatString +'?\\n\\nWarning: All child categories will be moved up one level!')) {\n\t\t\treturn false;\n\t\t}\n\n        $.post(\"api/i/categories/delete\", { cid: cid }, null ,'json')\n            .done(function( json ) {\n                alert(json.data);\n                CategoryManage.grabNextLevel(CategoryManage.currentSelection[CategoryManage.currentSelection.length-2]);\n            });\n\t},\n\n\tgetCatString: function() {\n\t\tvar catString = '';\n\n\t\tfor (var i=0; i<this.currentSelection.length; i++) {\n\t\t\tif ($(\"#level\"+(i+1))) {\n\t\t\t\tvar elt = $(\"#level\"+(i+1)+\" option:selected\");\n\n\t\t\t\tif (elt.text() != 'Select:') {\n\t\t\t\t\tcatString += elt.text() + ':';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (catString.length > 0) {\n\t\t\treturn catString.substring(0, catString.length - 1);\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t},\n};\n"],"sourceRoot":"/source/"}