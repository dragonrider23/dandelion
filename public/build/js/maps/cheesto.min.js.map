{"version":3,"sources":["cheesto.js"],"names":["newStatus","presence","timeoutId","version","firstgen","checkstat","ver","$","getJSON","data","generateView","clearTimeout","setTimeout","dataObj","this","updateTableOnly","appendable","attr","append","makeStatusSelect","tableView","userStatusesDiv","makeTableMini","makeTableFull","html","statusSelectDiv","statusSelect","change","setStatus","key2","statusOptions","table","tableHead","key","hasOwnProperty","user","classm","message","realname","status","returntime","statusInfo","color","symbol","popOutButton","dmodified","prop","rtime","window","open","sendNewStatus","popOut","stat","rt","post","showHideP","css"],"mappings":"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","file":"cheesto.min.js","sourcesContent":["/* global $, clearTimeout, setTimeout, window */\n/* jshint multistr: true */\n\n\"use strict\"; // jshint ignore:line\nvar newStatus = 1;\n\nvar presence =\n{\n    timeoutId: 0,\n    version: 0,\n    firstgen: true,\n\n    checkstat: function (ver) {\n        $.getJSON(\"api/i/cheesto/readall\",\n            function (data) {\n                presence.generateView(ver, data);\n                clearTimeout(presence.timeoutId);\n                delete presence.timeoutId;\n\n                presence.version = ver;\n                presence.timeoutId = setTimeout(function () {\n                    presence.checkstat(ver);\n                }, 30000);\n            });\n    },\n\n    generateView: function (ver, dataObj) {\n        dataObj = dataObj.data;\n\n        if (!this.firstgen) {\n            this.updateTableOnly(ver, dataObj);\n            return;\n        }\n\n        var appendable = $('<div/>').attr('id', 'pt');\n\n        // Generate select box of status options\n        appendable.append(presence.makeStatusSelect(ver, dataObj));\n\n        var userStatusesDiv = $('<div/>').attr('id', 'userStatuses');\n        var tableView;\n        // Generate status table depending on view version\n        if (ver === 0) {\n            tableView = this.makeTableMini(dataObj);\n        }\n        else if (ver === 1) {\n            tableView = this.makeTableFull(dataObj);\n        }\n        userStatusesDiv.append(tableView);\n        appendable.append(userStatusesDiv);\n\n        $('#mainPresence').html(appendable);\n    },\n\n    updateTableOnly: function (ver, dataObj) {\n        var tableView;\n        // Generate status table depending on view version\n        if (ver === 0) {\n            tableView = this.makeTableMini(dataObj);\n        }\n        else if (ver === 1) {\n            tableView = this.makeTableFull(dataObj);\n        }\n        $('#userStatuses').html(tableView);\n    },\n\n    /**\n     * @param {{statusOptions:string}} dataObj\n     */\n    makeStatusSelect: function (ver, dataObj) {\n        var statusSelectDiv = $('<div/>').attr('id', 'statusSelect');\n        var statusSelect = $('<select/>').attr('id', 'cstatus');\n        statusSelect.change(function () {\n            presence.setStatus(ver);\n        });\n        statusSelect.append('<option value=\"-1\">Set Status:</option>');\n\n        for (var key2 in dataObj.statusOptions) {\n            var html = '<option>' + dataObj.statusOptions[key2] + '</option>';\n            statusSelect.append(html);\n        }\n\n        statusSelectDiv.append(statusSelect);\n        this.firstgen = false;\n        return statusSelectDiv;\n    },\n\n    /**\n     * @param {{statusInfo:object}} dataObj\n     */\n    makeTableMini: function (dataObj) {\n        // Mini view on main page\n        var table = $('<table/>');\n        var tableHead = '<thead><tr>\\\n            <td width=\"50%\">Name</td>\\\n            <td width=\"50%\">Status</td>\\\n            </tr></thead>';\n\n        table.append(tableHead);\n\n        for (var key in dataObj) {\n            if (!dataObj.hasOwnProperty(key))\n                continue;\n\n            if (key !== \"statusOptions\") {\n                var user = dataObj[key];\n                var classm = '';\n\n                if (user.message !== '') {\n                    classm = ' class=\"message\"';\n                }\n\n                var html = '<tr>\\\n                    <td class=\"textLeft\"><span title=\"' + user.message + '\"' + classm + '>' + user.realname + '</span></td>\\\n                    <td><span title=\"' + dataObj.statusOptions[user.status] + '&#013;Return: ' + user.returntime + '\" class=\"' + user.statusInfo.color + '\">' + user.statusInfo.symbol + '</td>\\\n                    </tr>';\n\n                table.append(html);\n            }\n        }\n\n        var popOutButton = '<tr><td colspan=\"3\" width=\"100%\" class=\"cen\">\\\n            <form><input type=\"button\" onClick=\"presence.popOut();\" class=\"linklike\" value=\"Popout &#264;eesto\"></form>\\\n            </td></tr>';\n        table.append(popOutButton);\n\n        return table;\n    },\n\n    /**\n     * @param {{realname:string}} dataObj\n     */\n    makeTableFull: function (dataObj) {\n        // Windowed view\n        var table = $('<table/>');\n        var tableHead = '<thead><tr><td>Name</td>\\\n            <td>Message</td>\\\n            <td colspan=\"2\">Status</td>\\\n            <td>Last Changed</td>\\\n            </tr></thead><tbody>';\n        table.append(tableHead);\n\n        for (var key in dataObj) { // jshint ignore:line\n            if (!dataObj.hasOwnProperty(key))\n                continue;\n\n            if (key !== \"statusOptions\") {\n                var user = dataObj[key];\n\n                var html = '<tr>\\\n                    <td>' + user.realname + '</td>\\\n                    <td>' + user.message + '</td>\\\n                    <td class=\"statusi\"><span class=\"' + user.statusInfo.color + '\">' + user.statusInfo.symbol + '</span></td>';\n\n                if (user.status == 0) { // jshint ignore:line\n                    html += '<td>' + dataObj.statusOptions[user.status] + '</td>';\n                } else {\n                    html += '<td>' + dataObj.statusOptions[user.status] + '<br>Return: ' + user.returntime + '</td>';\n                }\n\n                html += '<td>' + user.dmodified + '</td></tr>';\n\n                table.append(html);\n            }\n        }\n\n        return table;\n    },\n\n    setStatus: function (ver) {\n        newStatus = $(\"select#cstatus\").prop(\"selectedIndex\") - 1;\n        $(\"select#cstatus\").prop(\"selectedIndex\", 0);\n        var rtime;\n\n        if (newStatus > 0) {\n            // Status requires a return time and optional status\n            rtime = \"\"; // jshint ignore:line\n            window.open(\"getdate\", \"getdate\", \"location=no,menubar=no,scrollbars=no,status=no,height=550,width=350\");\n        }\n        else if (newStatus === 0) {\n            // Status is Available\n            rtime = \"00:00:00\"; // jshint ignore:line\n            presence.sendNewStatus(0, rtime, ver, \"\");\n        }\n    },\n\n    popOut: function () {\n        window.open(\"presenceWindow\", \"presencewin\", \"location=no,menubar=no,scrollbars=no,status=no,height=500,width=950\");\n    },\n\n    sendNewStatus: function (stat, rt, ver, message) {\n        $.post(\"api/i/cheesto/update\", {status: stat, returntime: rt, message: message},\n            function () {\n                presence.checkstat(ver);\n            });\n    },\n\n    showHideP: function () {\n        if ($(\"#showHide\").html() == \"[ - ]\") {\n            $(\"#presence\").css(\"minWidth\", $(\"#mainPresence\").prop(\"offsetWidth\") + \"px\");\n            $(\"#mainPresence\").css(\"display\", \"none\");\n            $(\"#showHide\").html(\"[ + ]\");\n        }\n        else {\n            $(\"#presence\").css(\"minWidth\", \"0px\");\n            $(\"#mainPresence\").css(\"display\", \"\");\n            $(\"#showHide\").html(\"[ - ]\");\n        }\n    }\n};\n"],"sourceRoot":"/source/"}