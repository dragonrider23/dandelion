{"version":3,"sources":["userManagerForms.js"],"names":["userManager","uiforms","add","rightsList","$","ajax","async","dataType","done","json","errorcode","data","alert","status","table","append","roleRow","roleCell","select","attr","key","hasOwnProperty","group","role","this","showDialogBox","title","buttonText1","edit","userinfo","themeList","uid","currentuid","userid","realname","selected","themeRow","themeCell","select1","theme","key1","selected1","datecreated","firsttime","height","delete","buttonText2","reset","cxeesto","statusRow","statusCell","statusSelect","statusOptions","message","returntime","datetimepicker","timeFormat","controlType","stepMinute","width","revokeKey","func","customize","dialog_buttons","dialog","modal","show","effect","duration","hide","buttons"],"mappings":"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","file":"userManagerForms.min.js","sourcesContent":["/* global $, alert, userManager */\n\n\"use strict\"; // jshint ignore:line\n\nuserManager.uiforms = {\n    add: function() { // Create user form\n        var rightsList = null;\n\n        $.ajax('api/i/rights/getlist', {\n            async: false,\n            dataType: 'json'\n        })\n            .done(function(json) {\n                if (json.errorcode === 0) {\n                    rightsList = json.data;\n                } else {\n                    alert(json.status);\n                }\n                return;\n            });\n\n        var table = $('<table/>');\n        table.append('<tr><td>Username:</td><td><input type=\"text\" id=\"add_user\" autocomplete=\"off\"></td></tr>');\n        table.append('<tr><td>Password:</td><td><input type=\"password\" id=\"add_pass\"></td></tr>');\n        table.append('<tr><td>Real Name:</td><td><input type=\"text\" id=\"add_fullname\" autocomplete=\"off\"></td></tr>');\n\n        var roleRow = $('<tr/>');\n        roleRow.append('<td>Role:</td>');\n\n        var roleCell = $('<td/>');\n        var select = $('<select/>').attr('id', 'add_group');\n        select.append('<option value=\"0\">Select:</option>');\n        for (var key in rightsList) {\n            if (!rightsList.hasOwnProperty(key))\n                continue;\n\n            var group = rightsList[key];\n            select.append('<option value=\"' + group.role + '\">' + group.role + '</option>');\n        }\n        roleCell.append(select);\n        roleRow.append(roleCell);\n        table.append(roleRow);\n\n        $('#dialog').append(table);\n        this.showDialogBox('add', {title: 'Add new user', buttonText1: 'Add'});\n        return;\n    },\n\n    edit: function() { // Edit user form\n        var userinfo = null;\n        var rightsList = null;\n        var themeList = null;\n\n        // Load user\n        $.ajax('api/i/users/getuserinfo', {\n            async: false,\n            dataType: 'json',\n            data: {uid: userManager.currentuid}\n        })\n            .done(function(json) {\n                if (json.errorcode === 0) {\n                    userinfo = json.data;\n                } else {\n                    alert(json.status);\n                }\n                return;\n            });\n\n        // Load rights groups\n        $.ajax('api/i/rights/getlist', {\n            async: false,\n            dataType: 'json'\n        })\n            .done(function(json) {\n                if (json.errorcode === 0) {\n                    rightsList = json.data;\n                } else {\n                    alert(json.status);\n                }\n                return;\n            });\n\n        // Load theme list\n        $.ajax('api/i/usersettings/getthemelist', {\n            async: false,\n            dataType: 'json'\n        })\n            .done(function(json) {\n                if (json.errorcode === 0) {\n                    themeList = json.data;\n                } else {\n                    alert(json.status);\n                }\n                return;\n            });\n\n        var table = $('<table/>');\n        table.append('<tr><td>User ID:</td><td><input type=\"text\" id=\"edit_uid\" value=\"'+userinfo.userid+'\" readonly></td></tr>');\n        table.append('<tr><td>Real Name:</td><td><input type=\"text\" id=\"edit_fullname\" value=\"'+userinfo.realname+'\" autocomplete=\"off\"></td></tr>');\n\n        // Build and append row for rights groups select box\n        var roleRow = $('<tr/>');\n        roleRow.append('<td>Role:</td>');\n        var roleCell = $('<td/>');\n        var select = $('<select/>').attr('id', 'edit_group');\n        for (var key in rightsList) {\n            if (!rightsList.hasOwnProperty(key))\n                continue;\n\n            var group = rightsList[key];\n            var selected = '';\n            if (group.role == userinfo.role) { selected = 'selected'; }\n            select.append('<option value=\"' + group.role + '\" '+selected+'>' + group.role + '</option>');\n        }\n        roleCell.append(select);\n        roleRow.append(roleCell);\n        table.append(roleRow);\n\n        // Build and append row for theme select box\n        var themeRow = $('<tr/>');\n        themeRow.append('<td>Theme:</td>');\n        var themeCell = $('<td/>');\n        var select1 = $('<select/>').attr('id', 'edit_theme');\n        if (userinfo.theme === '') { select1.append('<option value=\"\" selected>Default</option>'); }\n        else { select1.append('<option value=\"\">Default</option>'); }\n\n        for (var key1 in themeList) {\n            if (!themeList.hasOwnProperty(key1))\n                continue;\n\n            var theme = themeList[key1];\n            var selected1 = '';\n            if (theme == userinfo.theme) { selected1 = 'selected'; }\n            select1.append('<option value=\"' + theme + '\" '+selected1+'>' + theme + '</option>');\n        }\n        themeCell.append(select1);\n        themeRow.append(themeCell);\n        table.append(themeRow);\n\n        table.append('<tr><td>Date Created:</td><td><input type=\"text\" value=\"'+userinfo.datecreated+'\" readonly></td></tr>');\n        table.append('<tr><td>Prompt:</td><td><input type=\"text\" id=\"edit_prompt\" value=\"'+userinfo.firsttime+'\"></td></tr>');\n\n        $('#dialog').append(table);\n        this.showDialogBox('edit', {title: 'Edit user', buttonText1: 'Save', height: 330});\n        return;\n    },\n\n    delete: function() { // Delete user form\n        $('#dialog').append('Are you sure you want to delete user X?');\n        this.showDialogBox('delete', {buttonText1: 'Yes', buttonText2: 'No'});\n        return;\n    },\n\n    reset: function() { // Reset user password form\n        // jshint multistr:true\n        $('#dialog').append('<table>\\\n                                <tr><td>New Password:</td><td><input type=\"password\" id=\"pass1\"></td></tr>\\\n                                <tr><td>Repeat Password:</td><td><input type=\"password\" id=\"pass2\"></td></tr>\\\n                            </table>');\n        this.showDialogBox('reset', {buttonText1: 'Reset'});\n        return;\n    },\n\n    cxeesto: function() { // Change user status form\n        var status = null;\n\n        // Load user\n        $.ajax('api/i/cheesto/read', {\n            async: false,\n            dataType: 'json',\n            data: {uid: userManager.currentuid}\n        })\n            .done(function(json) {\n                if (json.errorcode === 0) {\n                    status = json;\n                } else {\n                    alert(json.status);\n                }\n                return;\n            });\n\n        var table = $('<table/>');\n        table.append('<tr><td>User ID:</td><td><input type=\"text\" id=\"status_uid\" value=\"'+status.data.uid+'\" readonly></td></tr>');\n        table.append('<tr><td>Name:</td><td><input type=\"text\" id=\"status_name\" value=\"'+status.data.realname+'\" readonly></td></tr>');\n\n        var statusRow = $('<tr/>');\n        statusRow.append('<td>Status:</td>');\n        var statusCell = $('<td/>');\n        var statusSelect = $('<select/>').attr('id', 'status_text');\n        statusSelect.append('<option value=\"-1\">Set Status:</option>');\n        for (var key in status.data.statusOptions) {\n            statusSelect.append('<option>'+status.data.statusOptions[key]+'</option>');\n        }\n        statusCell.append(statusSelect);\n        statusRow.append(statusCell);\n        table.append(statusRow);\n\n        table.append('<tr><td>Message:</td><td><textarea cols=\"30\" rows=\"5\" id=\"status_message\">'+status.data.message+'</textarea></td></tr>');\n        table.append('<tr><td>Return:</td><td><input type=\"text\" id=\"status_return\" value=\"'+status.data.returntime+'\"></td></tr>');\n\n        $('#dialog').append(table);\n\n        $('#status_return').datetimepicker({\n                        timeFormat: \"HH:mm\",\n                        controlType: 'select',\n                        stepMinute: 10\n                    });\n\n        this.showDialogBox('cxeesto', {title: 'Set User Status', height: 380, width: 515, buttonText1: 'Save'});\n        return;\n    },\n\n    revokeKey: function() { // Confirm key revoke form\n        $('#dialog').append('Are you sure you want to revoke the API key for user X?');\n        this.showDialogBox('revokeKey', {buttonText1: 'Yes', buttonText2: 'No'});\n        return;\n    },\n\n    showDialogBox: function(func, customize) {\n        // Check customization settings\n        if (typeof customize == 'undefined') {\n            customize = {};\n        }\n        if (typeof customize.height == 'undefined') {\n            customize.height = 300;\n        }\n        if (typeof customize.width == 'undefined') {\n            customize.width = 450;\n        }\n        if (typeof customize.title == 'undefined') {\n            customize.title = '';\n        }\n        if (typeof customize.buttonText1 == 'undefined') {\n            customize.buttonText1 = 'Okay';\n        }\n        if (typeof customize.buttonText2 == 'undefined') {\n            customize.buttonText2 = 'Cancel';\n        }\n\n        // Build dialog buttons\n        var dialog_buttons = {};\n\n        dialog_buttons[customize.buttonText1] = function() {\n            $(this).dialog(\"close\");\n            userManager[func]();\n            return;\n        };\n        dialog_buttons[customize.buttonText2] = function() {\n            $(this).dialog(\"close\");\n            return;\n        };\n\n        // Build and show dialog\n        $(\"#dialog\").attr('title', customize.title);\n        $(\"#dialog\").dialog({\n            height: customize.height,\n            width: customize.width,\n            modal: true,\n            show: {\n                effect: \"fade\",\n                duration: 500\n            },\n            hide: {\n                effect: \"fade\",\n                duration: 250\n            },\n            buttons: dialog_buttons\n        });\n\n        return;\n    },\n};\n"],"sourceRoot":"/source/"}