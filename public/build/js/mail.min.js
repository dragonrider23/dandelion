"use strict";$(document).ready(function(){$("#writeMail").css("display","none"),mail.showFolder()}),$(document).on("focusin",function(t){$(t.target).closest(".mce-window").length&&t.stopImmediatePropagation()});var mail={areUnread:function(){$.getJSON("api/i/mail/mailCount",function(t){t.data.count>0&&($("#mailicon").attr("src","static/images/mail.png"),$("#mailicon").attr("alt","You have mail"),$("#mailicon").attr("title",t.data.count))}),setTimeout(function(){mail.areUnread()},1e4)},showFolder:function(){var t=$("#folder").val();switch(t){case"inbox":this.getAllMail();break;case"trash":this.getTrashCan()}},getAllMail:function(){$.getJSON("api/i/mail/getAllMail",function(t){mail.showMailList(t.data)})},getTrashCan:function(){$.getJSON("api/i/mail/getAllMail",{trash:"true"},function(t){mail.showMailList(t.data)})},showMailList:function(t){var e=t.length;$("#mailList").html("");var a=$("<table/>").addClass("mailboxCSS");a.append('<tr>                    <th width="2%">&nbsp;</th>                    <th width="15%">From</th>                    <th width="63%">Subject</th>                    <th width="20%">Date</th>            </tr>');for(var i=0;e>i;i++){var l=t[i],o='<tr>                    <td><input type="checkbox" id="check'+i+'" value='+l.id+"></td>                    <td>"+l.realname+'</td>                    <td><a href="#" onClick="mail.viewMail('+l.id+');">'+l.subject+"</a></td>                    <td>"+l.dateSent+"</td>                    </tr>";a.append("0"==l.isItRead?$(o).addClass("unread"):o)}$("#mailList").append(a)},viewMail:function(t){$.getJSON("api/i/mail/read",{mid:t},function(t){t=t.data,mail.showFolder();var e="<h2>"+t[0].subject+"</h2>                To: You<br>                From: "+t[0].realname+"<br>                Sent: "+t[0].dateSent+" "+t[0].timeSent+"<br>                <br>"+t[0].body;$("#mailDialog").html(e),$("#mailDialog").dialog({modal:!0,width:400,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{Ok:function(){$(this).dialog("close"),$("#mailDialog").html("")}}})})},replyToMail:function(){var t=this.getSelectedMailIds();1==t.length&&$.getJSON("api/i/mail/read",{mid:t[0]},function(t){t=t.data,$("#mailForm")[0].reset(),$("textarea#mailBody").html(t[0].body),$("#mailSubject").val("RE: "+t[0].subject),$("#toUsersId").val(t[0].fromUser),$("#toUsers").val(t[0].realname),$("#toUsers").prop("readonly",!0),mail.showWriteDialog()})},writeMailDialog:function(){$.getJSON("api/i/mail/getUserList",function(t){t=t.data,$("#mailForm")[0].reset(),$("#toUsers").prop("readonly",!1),$("textarea#mailBody").html(""),$("#toUsersId").val(""),mail.showWriteDialog();var e=[];$(t).each(function(t,a){var i=[];i.label=a.realname,i.value=a.userid,e.push(i)}),$("#toUsers").autocomplete({minLength:0,source:e,focus:function(t,e){return $("#toUsers").val(e.item.label),!1},select:function(t,e){return $("#toUsers").val(e.item.label),$("#toUsersId").val(e.item.value),!1}}).data("ui-autocomplete")._renderItem=function(t,e){return $("<li>").append("<a>"+e.label+"</a>").appendTo(t)}})},showWriteDialog:function(){$("#writeMail").dialog({height:575,width:800,modal:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},buttons:{"Send Mail":function(){mail.sendMail()&&($(this).dialog("close"),mail.showFolder())},Cancel:function(){$(this).dialog("close")}}}),$("textarea#mailBody").tinymce({browser_spellcheck:!0,forced_root_block:!1,resize:!1,menubar:"edit format view insert tools",toolbar:"undo redo | styleselect | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | forecolor",plugins:["autolink link lists hr anchor pagebreak","searchreplace wordcount code insertdatetime","template paste textcolor"]})},sendMail:function(){var t={};return t.to=$("#toUsersId").val(),t.subject=$("#mailSubject").val(),t.body=$("#mailBody").val(),""!==t.to&&""!==t.subject&&""!==t.body?(t=JSON.stringify(t),$.post("api/i/mail/send",{mail:t},function(t){t=JSON.parse(t),alert(t.data)}),!0):(alert("Error: You need a subject, body, and recipient."),!1)},deleteMail:function(){var t=this.getSelectedMailIds();if(1===t.length&&confirm("Delete Selected Mail?")){var e=!1;"trash"==$("#folder").val()&&(e=!0),$.post("api/i/mail/delete",{mid:t[0],permenant:e},function(t){t=JSON.parse(t),mail.showFolder(),alert(t.data)})}},getSelectedMailIds:function(){var t=[];return $("#mailList :checked").each(function(){t.push($(this).val())}),t}};
//# sourceMappingURL=maps/mail.min.js.map